import{_ as F}from"./Br_2l1z2.js";import{_ as U}from"./CtY9RrY5.js";import{_ as q}from"./RyBLt_tc.js";import{_ as A}from"./CdUQPPYw.js";import{_ as I,a as R}from"./CfG1-w7I.js";import{p as T,_ as j}from"./CEXRc7iu.js";import{f as L,y as P,z as D,A as G,B as g,C as H,c as w,j as J,a as x,b as a,k as t,D as K,w as n,E as O,o as V,e as Q,d as E,g as W,G as k,H as v,l as X,I as l}from"#entry";import{z as _}from"./ChM03Ocf.js";import{n as Y}from"./Zkazc4B7.js";const Z=_.object({email:_.email("Email is not valid"),password:T,rememberMe:_.boolean().optional()}),ee={key:0,class:"mb-3"},ae={class:"flex items-center gap-2 justify-between"},de=L({__name:"login-form",setup(te){const c=X(),M=P(),b=D(),S=G(),i=g(!1),o=H({email:"",password:"",rememberMe:!0});function N(){o.email="",o.password="",o.rememberMe=!0}const m=g(null);async function y(d){m.value=null,await k.signIn.email(d.data,{onError(e){m.value=Y(e.error)},async onSuccess(){N();const e=await k.getSession();if(!e.data)throw v({status:500,statusMessage:c.public.defaultErrorMsg,fatal:!0});b.setSession(e.data.session),b.setUser(e.data.user);const{redirect:u}=M.query;if(u){await l(u.toString());return}if(!e.data?.user.emailVerified){const p=btoa(d.data.email);await l({name:"email-verification",query:{email:p}});return}const r=e.data?.user.role;if(!r)throw v({status:500,statusMessage:c.public.defaultErrorMsg,fatal:!0});switch(r){case"applicant":await l("/application/portal");break;case"student":i.value?await l("/application/portal"):await l("/portal/student");break;case"staff":alert(r);break;case"admin":await l("/portal/admin");break;default:S.add({color:"error",title:"Error",description:c.public.defaultErrorMsg});break}}})}return(d,e)=>{const u=F,r=U,p=q,C=A,f=R,z=j,$=Q,h=W,B=I;return V(),w("div",null,[t(m)?(V(),w("div",ee,[a(u,{message:t(m).message},null,8,["message"])])):J("",!0),x("div",null,[a(r,{modelValue:t(i),"onUpdate:modelValue":e[0]||(e[0]=s=>K(i)?i.value=s:null),label:"Log in to application portal"},null,8,["modelValue"])]),a(p,{class:"my-5"}),a(B,{schema:t(Z),state:t(o),class:"space-y-4",onSubmit:O(y,["prevent"])},{default:n(()=>[a(f,{label:"Email",name:"email",required:""},{default:n(()=>[a(C,{modelValue:t(o).email,"onUpdate:modelValue":e[1]||(e[1]=s=>t(o).email=s),size:"lg",class:"w-full"},null,8,["modelValue"])]),_:1}),a(f,{label:"Password",name:"password",required:""},{default:n(()=>[a(z,{modelValue:t(o).password,"onUpdate:modelValue":e[2]||(e[2]=s=>t(o).password=s),size:"lg",class:"w-full"},null,8,["modelValue"])]),_:1}),x("div",ae,[a(f,{name:"rememberMe"},{default:n(()=>[a(r,{modelValue:t(o).rememberMe,"onUpdate:modelValue":e[3]||(e[3]=s=>t(o).rememberMe=s),label:"Remember me"},null,8,["modelValue"])]),_:1}),a($,{to:"/forgot-password",class:"link text-sm"},{default:n(()=>[...e[4]||(e[4]=[E(" Forgot password ",-1)])]),_:1})]),a(h,{type:"submit",class:"mt-2 w-full flex-center",size:"lg",icon:"i-lucide:log-in","loading-auto":""},{default:n(()=>[...e[5]||(e[5]=[E(" Submit ",-1)])]),_:1})]),_:1},8,["schema","state"])])}}});export{de as _};
