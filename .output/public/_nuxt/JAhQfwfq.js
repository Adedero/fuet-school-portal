import{_ as F}from"./Br_2l1z2.js";import{_ as U}from"./BvPn1KVB.js";import{_ as q}from"./CRVZdzxc.js";import{_ as A}from"./iSq_GXOF.js";import{_ as I,a as R}from"./2EICDMI2.js";import{p as T,_ as j}from"./sc3yzrxI.js";import{f as L,y as P,z as D,A as G,B as w,C as H,c as x,j as J,a as V,b as a,k as t,D as K,w as n,E as O,o as E,e as Q,d as k,g as W,G as v,H as M,l as X,I as l}from"#entry";import{z as b}from"./CQ9DD0Tp.js";import{n as Y}from"./Zkazc4B7.js";const Z=b.object({email:b.email("Email is not valid"),password:T,rememberMe:b.boolean().optional()}),ee={key:0,class:"mb-3"},ae={class:"flex items-center gap-2 justify-between"},de=L({__name:"login-form",setup(te){const d=X(),S=P(),g=D(),N=G(),u=w(!1),o=H({email:"",password:"",rememberMe:!0});function y(){o.email="",o.password="",o.rememberMe=!0}const c=w(null);async function C(p){c.value=null;const e=p.data.email;await v.signIn.email(p.data,{onError(s){c.value=Y(s.error)},async onSuccess(){y();const s=await v.getSession();if(!s.data)throw M({status:500,statusMessage:d.public.defaultErrorMsg,fatal:!0});g.setSession(s.data.session),g.setUser(s.data.user);const{redirect:i}=S.query;if(i){await l(i.toString());return}if(!s.data?.user.emailVerified){const f=btoa(e);await l({name:"email-verification",query:{email:f}});return}const m=s.data?.user.role;if(!m)throw M({status:500,statusMessage:d.public.defaultErrorMsg,fatal:!0});switch(m){case"applicant":await l("/application/portal");break;case"student":u.value?await l("/application/portal"):await l("/portal/student");break;case"staff":alert(m);break;case"admin":await l("/portal/admin");break;default:N.add({color:"error",title:"Error",description:d.public.defaultErrorMsg});break}}})}return(p,e)=>{const s=F,i=U,m=q,f=A,_=R,z=j,$=Q,h=W,B=I;return E(),x("div",null,[t(c)?(E(),x("div",ee,[a(s,{message:t(c).message},null,8,["message"])])):J("",!0),V("div",null,[a(i,{modelValue:t(u),"onUpdate:modelValue":e[0]||(e[0]=r=>K(u)?u.value=r:null),label:"Log in to application portal"},null,8,["modelValue"])]),a(m,{class:"my-5"}),a(B,{schema:t(Z),state:t(o),class:"space-y-4",onSubmit:O(C,["prevent"])},{default:n(()=>[a(_,{label:"Email",name:"email",required:""},{default:n(()=>[a(f,{modelValue:t(o).email,"onUpdate:modelValue":e[1]||(e[1]=r=>t(o).email=r),size:"lg",class:"w-full"},null,8,["modelValue"])]),_:1}),a(_,{label:"Password",name:"password",required:""},{default:n(()=>[a(z,{modelValue:t(o).password,"onUpdate:modelValue":e[2]||(e[2]=r=>t(o).password=r),size:"lg",class:"w-full"},null,8,["modelValue"])]),_:1}),V("div",ae,[a(_,{name:"rememberMe"},{default:n(()=>[a(i,{modelValue:t(o).rememberMe,"onUpdate:modelValue":e[3]||(e[3]=r=>t(o).rememberMe=r),label:"Remember me"},null,8,["modelValue"])]),_:1}),a($,{to:"/forgot-password",class:"link text-sm"},{default:n(()=>[...e[4]||(e[4]=[k(" Forgot password ",-1)])]),_:1})]),a(h,{type:"submit",class:"mt-2 w-full flex-center",size:"lg",icon:"i-lucide:log-in","loading-auto":""},{default:n(()=>[...e[5]||(e[5]=[k(" Submit ",-1)])]),_:1})]),_:1},8,["schema","state"])])}}});export{de as _};
