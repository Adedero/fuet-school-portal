import{_ as h}from"./BtPAQVJY.js";import{_ as z}from"./CsCpuQOu.js";import{_ as B,a as F}from"./tvyaI-9O.js";import{p as $,_ as q}from"./BBqBNx5g.js";import{_ as U}from"./DoiJs5pB.js";import{f as j,v as A,x as R,y as T,z as D,A as I,c as f,j as P,b as t,k as s,w as n,B as L,o as b,a as G,e as H,d as w,g as J,C as g,D as x,l as K,E as u}from"#entry";import{z as p}from"./BnhhJy-q.js";import{n as O}from"./Zkazc4B7.js";const Q=p.object({email:p.email("Email is not valid"),password:$,rememberMe:p.boolean().optional()}),W={key:0,class:"mb-3"},X={class:"flex items-center gap-2 justify-between"},le=j({__name:"login-form",setup(Y){const c=K(),V=A(),_=R(),E=T(),a=D({email:"",password:"",rememberMe:!0});function k(){a.email="",a.password="",a.rememberMe=!0}const i=I(null);async function M(d){i.value=null;const e=btoa(d.data.email);await g.signIn.email(d.data,{onError(o){i.value=O(o.error)},async onSuccess(){k();const o=await g.getSession();if(!o.data)throw x({status:500,statusMessage:c.public.defaultErrorMsg,fatal:!0});_.setSession(o.data.session),_.setUser(o.data.user);const{redirect:m}=V.query;if(m){await u(m.toString());return}if(!o.data?.user.emailVerified){await u({name:"email-verification",query:{email:e}});return}const r=o.data?.user.role;if(!r)throw x({status:500,statusMessage:c.public.defaultErrorMsg,fatal:!0});switch(r){case"applicant":await u("/application/portal");break;case"student":alert(r);break;case"staff":alert(r);break;case"admin":await u("/portal/admin");break;default:E.add({color:"error",title:"Error",description:c.public.defaultErrorMsg});break}}})}return(d,e)=>{const o=h,m=z,r=F,S=q,v=U,N=H,y=J,C=B;return b(),f("div",null,[s(i)?(b(),f("div",W,[t(o,{message:s(i).message},null,8,["message"])])):P("",!0),t(C,{schema:s(Q),state:s(a),class:"space-y-4",onSubmit:L(M,["prevent"])},{default:n(()=>[t(r,{label:"Email",name:"email",required:""},{default:n(()=>[t(m,{modelValue:s(a).email,"onUpdate:modelValue":e[0]||(e[0]=l=>s(a).email=l),size:"lg",class:"w-full"},null,8,["modelValue"])]),_:1}),t(r,{label:"Password",name:"password",required:""},{default:n(()=>[t(S,{modelValue:s(a).password,"onUpdate:modelValue":e[1]||(e[1]=l=>s(a).password=l),size:"lg",class:"w-full"},null,8,["modelValue"])]),_:1}),G("div",X,[t(r,{name:"rememberMe"},{default:n(()=>[t(v,{modelValue:s(a).rememberMe,"onUpdate:modelValue":e[2]||(e[2]=l=>s(a).rememberMe=l),label:"Remember me"},null,8,["modelValue"])]),_:1}),t(N,{to:"/forgot-password",class:"link text-sm"},{default:n(()=>[...e[3]||(e[3]=[w(" Forgot password ",-1)])]),_:1})]),t(y,{type:"submit",class:"mt-2 w-full flex-center",size:"lg",icon:"i-lucide:log-in","loading-auto":""},{default:n(()=>[...e[4]||(e[4]=[w(" Submit ",-1)])]),_:1})]),_:1},8,["schema","state"])])}}});export{le as _};
