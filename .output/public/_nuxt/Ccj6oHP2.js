import{_ as h}from"./BzV1xtw9.js";import{_ as z,a as $,b as q}from"./Dcr2-6YO.js";import{p as B,_ as F}from"./C4e-zCCc.js";import{_ as U}from"./BKfmL_0Z.js";import{f as A,n as R,q as T,s as j,v as I,x as P,c as _,k as D,b as t,i as s,w as n,y as L,o as b,a as G,e as H,d as g,g as J,z as w,A as x,B as K,C as c}from"#entry";import{z as d}from"./Jvy9P-lb.js";import{n as O}from"./Zkazc4B7.js";const Q=d.object({email:d.email("Email is not valid"),password:B,rememberMe:d.boolean().optional()}),W={key:0,class:"mb-3"},X={class:"flex items-center gap-2 justify-between"},ne=A({__name:"login-form",setup(Y){const p=K(),V=R(),f=T(),k=j(),a=I({email:"",password:"",rememberMe:!0});function E(){a.email="",a.password="",a.rememberMe=!0}const i=P(null);async function M(u){i.value=null;const e=btoa(u.data.email);await w.signIn.email(u.data,{onError(o){i.value=O(o.error)},async onSuccess(){E();const o=await w.getSession();if(!o.data)throw x({status:500,statusMessage:p.public.defaultErrorMsg,fatal:!0});f.setSession(o.data.session),f.setUser(o.data.user);const{redirect:m}=V.query;if(m){await c(m.toString());return}if(!o.data?.user.emailVerified){await c({name:"email-verification",query:{email:e}});return}const r=o.data?.user.role;if(!r)throw x({status:500,statusMessage:p.public.defaultErrorMsg,fatal:!0});switch(r){case"applicant":await c("/application/portal");break;case"student":alert(r);break;case"staff":alert(r);break;case"admin":alert(r);break;default:k.add({color:"error",title:"Error",description:"runtimeConfig.public.defaultErrorMsg"});break}}})}return(u,e)=>{const o=h,m=q,r=$,S=F,v=U,N=H,y=J,C=z;return b(),_("div",null,[s(i)?(b(),_("div",W,[t(o,{message:s(i).message},null,8,["message"])])):D("",!0),t(C,{schema:s(Q),state:s(a),class:"space-y-4",onSubmit:L(M,["prevent"])},{default:n(()=>[t(r,{label:"Email",name:"email",required:""},{default:n(()=>[t(m,{modelValue:s(a).email,"onUpdate:modelValue":e[0]||(e[0]=l=>s(a).email=l),size:"lg",class:"w-full"},null,8,["modelValue"])]),_:1}),t(r,{label:"Password",name:"password",required:""},{default:n(()=>[t(S,{modelValue:s(a).password,"onUpdate:modelValue":e[1]||(e[1]=l=>s(a).password=l),size:"lg",class:"w-full"},null,8,["modelValue"])]),_:1}),G("div",X,[t(r,{name:"rememberMe"},{default:n(()=>[t(v,{modelValue:s(a).rememberMe,"onUpdate:modelValue":e[2]||(e[2]=l=>s(a).rememberMe=l),label:"Remember me"},null,8,["modelValue"])]),_:1}),t(N,{to:"/forgot-password",class:"link text-sm"},{default:n(()=>[...e[3]||(e[3]=[g(" Forgot password ",-1)])]),_:1})]),t(y,{type:"submit",class:"mt-2 w-full flex-center",size:"lg",icon:"i-lucide:log-in","loading-auto":""},{default:n(()=>[...e[4]||(e[4]=[g(" Submit ",-1)])]),_:1})]),_:1},8,["schema","state"])])}}});export{ne as _};
