import{T as re,L as Z,M as g,N as V,aD as _,B as S,ak as ee,aK as b,aL as se,i as te,o as v,w as J,a as U,P as d,c as O,j as C,b as ne,k as p,O as h,d as B,t as $,Q as ie,aM as ae,aN as le,aO as X,X as G,C as M,aC as H,a0 as oe,aP as D,aQ as ue,aR as de,E as ce,q as fe,aS as me}from"#entry";import{L as pe}from"./BZPIhiCP.js";import{b as ye}from"./DOVLR_vN.js";const ve={slots:{root:"",wrapper:"",labelWrapper:"flex content-center items-center justify-between",label:"block font-medium text-default",container:"mt-1 relative",description:"text-muted",error:"mt-2 text-error",hint:"text-muted",help:"mt-2 text-muted"},variants:{size:{xs:{root:"text-xs"},sm:{root:"text-xs"},md:{root:"text-sm"},lg:{root:"text-sm"},xl:{root:"text-base"}},required:{true:{label:"after:content-['*'] after:ms-0.5 after:text-error"}}},defaultVariants:{size:"md"}},he=["id"],be=["id"],ge=["id"],we=["id"],Ce={__name:"NuxtFormField",props:{as:{type:null,required:!1},name:{type:String,required:!1},errorPattern:{type:null,required:!1},label:{type:String,required:!1},description:{type:String,required:!1},help:{type:String,required:!1},error:{type:[Boolean,String],required:!1},hint:{type:String,required:!1},size:{type:null,required:!1},required:{type:Boolean,required:!1},eagerValidation:{type:Boolean,required:!1},validateOnInputDelay:{type:Number,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1}},setup(t){const a=t,s=re(),n=Z(),i=g(()=>V({extend:V(ve),...n.ui?.formField||{}})({size:a.size,required:a.required})),w=_(ae,null),m=g(()=>a.error||w?.value?.find(l=>l.name&&(l.name===a.name||a.errorPattern&&l.name.match(a.errorPattern)))?.message),c=S(ee()),f=c.value;return b(le,c),b(se,g(()=>({error:m.value,name:a.name,size:a.size,eagerValidation:a.eagerValidation,validateOnInputDelay:a.validateOnInputDelay,errorPattern:a.errorPattern,hint:a.hint,description:a.description,help:a.help,ariaId:f}))),(l,N)=>(v(),te(p(ie),{as:t.as,class:d(i.value.root({class:[a.ui?.root,a.class]}))},{default:J(()=>[U("div",{class:d(i.value.wrapper({class:a.ui?.wrapper}))},[t.label||s.label?(v(),O("div",{key:0,class:d(i.value.labelWrapper({class:a.ui?.labelWrapper}))},[ne(p(pe),{for:c.value,class:d(i.value.label({class:a.ui?.label}))},{default:J(()=>[h(l.$slots,"label",{label:t.label},()=>[B($(t.label),1)])]),_:3},8,["for","class"]),t.hint||s.hint?(v(),O("span",{key:0,id:`${p(f)}-hint`,class:d(i.value.hint({class:a.ui?.hint}))},[h(l.$slots,"hint",{hint:t.hint},()=>[B($(t.hint),1)])],10,he)):C("",!0)],2)):C("",!0),t.description||s.description?(v(),O("p",{key:1,id:`${p(f)}-description`,class:d(i.value.description({class:a.ui?.description}))},[h(l.$slots,"description",{description:t.description},()=>[B($(t.description),1)])],10,be)):C("",!0)],2),U("div",{class:d([(t.label||!!s.label||t.description||!!s.description)&&i.value.container({class:a.ui?.container})])},[h(l.$slots,"default",{error:m.value}),typeof m.value=="string"&&m.value||s.error?(v(),O("div",{key:0,id:`${p(f)}-error`,class:d(i.value.error({class:a.ui?.error}))},[h(l.$slots,"error",{error:m.value},()=>[B($(m.value),1)])],10,ge)):t.help||s.help?(v(),O("div",{key:1,id:`${p(f)}-help`,class:d(i.value.help({class:a.ui?.help}))},[h(l.$slots,"help",{help:t.help},()=>[B($(t.help),1)])],10,we)):C("",!0)],2)]),_:3},8,["as","class"]))}};function Se(t){return t.validate&&t.__isYupSchema__}function qe(t){return t.inner!==void 0}function xe(t){return"schema"in t&&typeof t.coercer=="function"&&typeof t.validator=="function"&&typeof t.refiner=="function"}function Ee(t){return t.validateAsync!==void 0&&t.id!==void 0}function Ie(t){return t.isJoi===!0}function je(t){return"~standard"in t}async function Fe(t,a){const s=await a["~standard"].validate(t);return s.issues?{errors:s.issues?.map(n=>({name:n.path?.map(i=>typeof i=="object"?i.key:i).join(".")||"",message:n.message}))||[],result:null}:{errors:null,result:s.value}}async function Oe(t,a){try{return{errors:null,result:await a.validate(t,{abortEarly:!1})}}catch(s){if(qe(s))return{errors:s.inner.map(i=>({name:i.path??"",message:i.message})),result:null};throw s}}async function Be(t,a){const[s,n]=a.validate(t);return s?{errors:s.failures().map(w=>({message:w.message,name:w.path.join(".")})),result:null}:{errors:null,result:n}}async function $e(t,a){try{return{errors:null,result:await a.validateAsync(t,{abortEarly:!1})}}catch(s){if(Ie(s))return{errors:s.details.map(i=>({name:i.path.join("."),message:i.message})),result:null};throw s}}function ke(t,a){if(je(a))return Fe(t,a);if(Ee(a))return $e(t,a);if(Se(a))return Oe(t,a);if(xe(a))return Be(t,a);throw new Error("Form validation failed: Unsupported form schema")}class k extends Error{formId;errors;children;constructor(a,s,n){super("Form validation exception"),this.formId=a,this.errors=s,this.children=n,Object.setPrototypeOf(this,k.prototype)}}const Ne={base:""},De={__name:"NuxtForm",props:{id:{type:[String,Number],required:!1},schema:{type:null,required:!1},state:{type:Object,required:!0},validate:{type:Function,required:!1},validateOn:{type:Array,required:!1,default(){return["input","blur","change"]}},disabled:{type:Boolean,required:!1},validateOnInputDelay:{type:Number,required:!1,default:300},transform:{type:null,required:!1,default:()=>!0},attach:{type:Boolean,required:!1,default:!0},loadingAuto:{type:Boolean,required:!1,default:!0},class:{type:null,required:!1},onSubmit:{type:Function,required:!1}},emits:["submit","error"],setup(t,{expose:a,emit:s}){const n=t,i=s,w=Z(),m=g(()=>V({extend:V(Ne),...w.ui?.form||{}})),c=n.id??ee(),f=ye(`form-${c}`),l=n.attach&&_(X,void 0);b(X,f);const N=S(new Map);G(async()=>{f.on(async e=>{e.type==="attach"?N.value.set(e.formId,{validate:e.validate}):e.type==="detach"?N.value.delete(e.formId):n.validateOn?.includes(e.type)&&!y.value&&(e.type!=="input"?await q({name:e.name,silent:!0,nested:!1}):(e.eager||K.has(e.name))&&await q({name:e.name,silent:!0,nested:!1})),e.type==="blur"&&K.add(e.name),(e.type==="change"||e.type==="input"||e.type==="blur"||e.type==="focus")&&R.add(e.name),(e.type==="change"||e.type==="input")&&z.add(e.name)})}),H(()=>{f.reset()}),G(async()=>{l&&(await oe(),l.emit({type:"attach",validate:q,formId:c}))}),H(()=>{l&&l.emit({type:"detach",formId:c})});const o=S([]);b(ae,o);const P=S({});b(me,P);const z=M(new Set),R=M(new Set),K=M(new Set);function L(e){return e.map(r=>({...r,id:r?.name?P.value[r.name]?.id:void 0}))}const W=S(null);async function Y(){let e=n.validate?await n.validate(n.state)??[]:[];if(n.schema){const{errors:r,result:u}=await ke(n.state,n.schema);r?e=e.concat(r):W.value=u}return L(e)}async function q(e={silent:!1,nested:!0,transform:!1}){const r=e.name&&!Array.isArray(e.name)?[e.name]:e.name,u=!r&&e.nested?Array.from(N.value.values()).map(({validate:x})=>x(e).then(()=>{}).catch(E=>{if(!(E instanceof k))throw E;return E})):[];if(r){const x=o.value.filter(I=>!r.some(j=>{const F=P.value?.[j]?.pattern;return j===I.name||F&&I.name?.match(F)})),E=(await Y()).filter(I=>r.some(j=>{const F=P.value?.[j]?.pattern;return j===I.name||F&&I.name?.match(F)}));o.value=x.concat(E)}else o.value=await Y();const A=(await Promise.all(u)).filter(x=>x!==void 0);if(o.value.length+A.length>0){if(e.silent)return!1;throw new k(c,o.value,A)}return e.transform&&Object.assign(n.state,W.value),n.state}const y=S(!1);b(ue,D(y));async function T(e){y.value=n.loadingAuto&&!0;const r=e;try{r.data=await q({nested:!0,transform:n.transform}),await n.onSubmit?.(r),z.clear()}catch(u){if(!(u instanceof k))throw u;const A={...r,errors:u.errors,children:u.children};i("error",A)}finally{y.value=!1}}const Q=g(()=>n.disabled||y.value);return b(de,g(()=>({disabled:Q.value,validateOnInputDelay:n.validateOnInputDelay}))),a({validate:q,errors:o,setErrors(e,r){r?o.value=o.value.filter(u=>r instanceof RegExp?!(u.name&&r.test(u.name)):u.name!==r).concat(L(e)):o.value=L(e)},async submit(){await T(new Event("submit"))},getErrors(e){return e?o.value.filter(r=>e instanceof RegExp?r.name&&e.test(r.name):r.name===e):o.value},clear(e){e?o.value=o.value.filter(r=>e instanceof RegExp?!(r.name&&e.test(r.name)):r.name!==e):o.value=[]},disabled:Q,loading:y,dirty:g(()=>!!z.size),dirtyFields:D(z),blurredFields:D(K),touchedFields:D(R)}),(e,r)=>(v(),te(fe(p(l)?"div":"form"),{id:p(c),class:d(m.value({class:n.class})),onSubmit:ce(T,["prevent"])},{default:J(()=>[h(e.$slots,"default",{errors:o.value,loading:y.value})]),_:3},40,["id","class"]))}};export{De as _,Ce as a};
